#Building on NCAR HPC:

# NOTE: Optional external libraries are invoked with the Makefile flags: isMPISERIAL and isPIO
#       Setting one or both to yes, will then invoke building them and linking them into the mizuRoute build.
#
# NOTE: Use of the external libraries REQUIRES running the "checkout_externals" as documented in the top
#       level directory (cd ../../; less README_EXTERNALS.rst)
#
# NOTE: 11/10/2023. use netcdf not netcdf-mpi which causes the compilation to fail (possibly on pio)
#                   Currently these are for cheyenne only. Will need to update for Derecho HPC.
#

# For gfortran with MPISERIAL  
# NM 11/10/2023 this is currently failing to build
module purge
module load gnu
module load netcdf

* tcsh or csh user:
setenv BLDDIR `pwd`/../
* bash user:
export BLDDIR=`pwd`/../
gmake FC=gnu FC_EXE=gfortran F_MASTER=$BLDDIR NCDF_PATH=$NETCDF EXE=route_runoff isMPISERIAL=yes isPIO=yes MODE=fast

# For gfortran with MPI and PIO2 libraries
module purge
module load gnu
module load mpt
module load netcdf

* tcsh or csh user:
setenv BLDDIR `pwd`/../
* bash user:
export BLDDIR=`pwd`/../
gmake FC=gnu FC_EXE=mpif90 F_MASTER=$BLDDIR NCDF_PATH=$NETCDF EXE=route_runoff MODE=fast

# For gfortran with MPI, PNETCDF, GPTL (timing) and PIO2 libraries
module purge
module load gnu
module load mpt
module load netcdf
module load pnetcdf

* tcsh or csh user:
setenv BLDDIR `pwd`/../
* bash user:
export BLDDIR=`pwd`/../
gmake FC=gnu FC_EXE=mpif90 F_MASTER=$BLDDIR NCDF_PATH=$NETCDF EXE=route_runoff PNETCDF_PATH=$PNETCDF MODE=fast

# For gfortran just with MPI (SO WITHOUT ANY OF THE EXTERNAL LIBRARIES)
module purge
module load gnu
module load mpt
module load netcdf

* tcsh or csh user:
setenv BLDDIR `pwd`/../
* bash user:
export BLDDIR=`pwd`/../
gmake FC=gnu FC_EXE=mpif90 F_MASTER=$BLDDIR NCDF_PATH=$NETCDF EXE=route_runoff MODE fast

# For intel with MPI, PNETCDF and installed PIO2 libraries
# EBK 9/30/2021 this is currently failing to build
module purge
module load intel
module load mpt
module load netcdf-mpi
module load pnetcdf
module load pio

* tcsh or csh user:
setenv BLDDIR `pwd`/../
gmake FC=intel FC_EXE=mpif90 F_MASTER=$BLDDIR NCDF_PATH=$NETCDF EXE=route_runoff PNETCDF_PATH=$PNETCDF \
      PIOLIBDIR=$PIO_LIBDIR PIOINCDIR=$PIO_INCDIR

# For intel with MPI, PNETCDF and PIO2 libraries
module purge
module load intel
module load mpt
module load netcdf
module load pnetcdf

* tcsh or csh user:
setenv BLDDIR `pwd`/../
* bash user:
export BLDDIR=`pwd`/../
gmake FC=intel FC_EXE=mpif90 F_MASTER=$BLDDIR NCDF_PATH=$NETCDF EXE=route_runoff PNETCDF_PATH=$PNETCDF MODE=fast

